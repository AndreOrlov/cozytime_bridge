# CozyTime BLE Bridge - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

## üìÅ –î–µ—Ä–µ–≤–æ —Ñ–∞–π–ª–æ–≤

```
cozytime_bridge/
‚îÇ
‚îú‚îÄ‚îÄ üìÑ README.md                      # –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ üìÑ PROTOCOL_ANALYSIS.md           # –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ BLE –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
‚îú‚îÄ‚îÄ üìÑ PROJECT_STRUCTURE.md           # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
‚îú‚îÄ‚îÄ üìÑ LICENSE                        # MIT License
‚îú‚îÄ‚îÄ üìÑ cozytime_bridge.yaml           # –ì–ª–∞–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ESPHome
‚îú‚îÄ‚îÄ üìÑ cozytime_parser.h              # C++ –ø–∞—Ä—Å–µ—Ä (legacy, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ üîí secrets.yaml                   # WiFi credentials –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ
‚îú‚îÄ‚îÄ üìÇ docs/                          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ README.md                  # –°–ø—Ä–∞–≤–∫–∞ –ø–æ datasheet SHT40
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ SHT40 Datasheet.pdf        # –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π datasheet Sensirion
‚îÇ
‚îú‚îÄ‚îÄ üìÇ helpers/                       # –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
‚îÇ   ‚îú‚îÄ‚îÄ üêç check_formula.py          # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ üêç analyze_timestamp.py     # –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
‚îÇ
‚îî‚îÄ‚îÄ üìÇ stats/                         # –°–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    ‚îú‚îÄ‚îÄ üìä data.csv                   # 18 –∫–∞–ª–∏–±—Ä–æ–≤–æ—á–Ω—ã—Ö —Ç–æ—á–µ–∫
    ‚îî‚îÄ‚îÄ üìä history.csv                # –ò—Å—Ç–æ—Ä–∏—è BLE –ø–∞–∫–µ—Ç–æ–≤ (1572 –∑–∞–ø–∏—Å–∏)
```

---

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã

### üìÑ README.md
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- –û–ø–∏—Å–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
- –§–æ—Ä–º–∞—Ç BLE –ø–∞–∫–µ—Ç–∞
- –§–æ—Ä–º—É–ª—ã —Ä–∞—Å—á–µ—Ç–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
- –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
- –ü—Ä–∏–º–µ—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–π

**–ö–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–¥–µ–ª—ã:**
- üì° –§–æ—Ä–º–∞—Ç BLE –ø–∞–∫–µ—Ç–∞ (14 –±–∞–π—Ç)
- üå°Ô∏è –§–æ—Ä–º—É–ª–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã (—Å –∫–∞–ª–∏–±—Ä–æ–≤–∫–æ–π)
- ‚è∞ Timestamp –≤ –ø–∞–∫–µ—Ç–µ
- üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ESPHome
- üîó –°—Å—ã–ª–∫–∞ –Ω–∞ [SHT40 Datasheet](docs/SHT40%20Datasheet.pdf)

---

### üìÑ PROTOCOL_ANALYSIS.md
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- –ü–æ–ª–Ω—É—é —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
- –ü—Ä–æ—Ü–µ—Å—Å —Ä–µ–≤–µ—Ä—Å-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥–∞
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏
- –ü—Ä–∏–º–µ—Ä—ã –ø–∞–∫–µ—Ç–æ–≤
- –ò—Å—Ç–æ—Ä–∏—è –∏—Ç–µ—Ä–∞—Ü–∏–π —Ñ–æ—Ä–º—É–ª—ã

**–ö–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–¥–µ–ª—ã:**
- üìä –î–µ—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –±–∞–π—Ç–æ–≤
- üî¨ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ SHT40
- üìà –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ—Ä–º—É–ª—ã (4 –∏—Ç–µ—Ä–∞—Ü–∏–∏)
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏

---

### üìÑ cozytime_bridge.yaml
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ESPHome
**–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è:** Native API + Lambda –ø–∞—Ä—Å–∏–Ω–≥
**–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è:** –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ MQTT + Custom Component

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- ESP32 BLE Tracker (UUID 0x51C9 + prefix check)
- Lambda –ø–∞—Ä—Å–µ—Ä BLE –ø–∞–∫–µ—Ç–æ–≤
- Sensors:
  - Temperature (¬∞F, –∫–∞–ª–∏–±—Ä–æ–≤–∞–Ω–Ω–∞—è)
  - Humidity (%)
  - Battery (%)
  - RSSI (dBm)
  - Temperature RAW (temp_value)
- Text Sensor: Raw packet (hex)
- Binary Sensor: ESP32 Status (online/offline)
- –ö–∞–ª–∏–±—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞: `T = 0.179987 √ó temp_value - 40.02`

---

### üìÇ docs/
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–∞—Ç—á–∏–∫–∞

#### üìÑ SHT40 Datasheet.pdf
- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Sensirion
- 15 —Å—Ç—Ä–∞–Ω–∏—Ü —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π
- –§–æ—Ä–º—É–ª—ã –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è (—Å—Ç—Ä. 3)
- –≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (—Å—Ç—Ä. 6-7)
- –¢–∏–ø–æ–≤–∞—è —Å—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (—Å—Ç—Ä. 3)

#### üìÑ docs/README.md
- –ö–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–¥–µ–ª—ã datasheet
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ CozyTime vs —Å—Ç–∞–Ω–¥–∞—Ä—Ç SHT40
- –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏ (GitHub, SnapEDA)

---

### üìÇ helpers/
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** Python —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö

#### üêç check_formula.py
**–§—É–Ω–∫—Ü–∏–∏:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
- –õ–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è (–±–µ–∑ numpy)
- –í—ã—á–∏—Å–ª–µ–Ω–∏–µ RMS –æ—à–∏–±–∫–∏, R¬≤
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –∏ –Ω–æ–≤–æ–π —Ñ–æ—Ä–º—É–ª—ã

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
python3 helpers/check_formula.py
```

#### üêç analyze_timestamp.py
**–§—É–Ω–∫—Ü–∏–∏:**
- –ü–∞—Ä—Å–∏–Ω–≥ timestamp –∏–∑ BLE –ø–∞–∫–µ—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–Ω–æ—Ç–æ–Ω–Ω–æ—Å—Ç–∏
- –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ HA timestamp vs BLE timestamp
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π (—Å—Ä–µ–¥–Ω–µ–µ, –º–∏–Ω, –º–∞–∫—Å)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ "—Å–≤–µ–∂–µ—Å—Ç–∏" –¥–∞–Ω–Ω—ã—Ö

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
python3 helpers/analyze_timestamp.py
```

---

### üìÇ stats/
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ–±—Ä–∞–Ω–Ω—ã–µ –∫–∞–ª–∏–±—Ä–æ–≤–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

#### üìä data.csv
**–§–æ—Ä–º–∞—Ç:** `Row data, T F from app, Place`
**–°—Ç—Ä–æ–∫:** 18 –∫–∞–ª–∏–±—Ä–æ–≤–æ—á–Ω—ã—Ö —Ç–æ—á–µ–∫
**–î–∏–∞–ø–∞–∑–æ–Ω:** -40¬∞F –¥–æ 91.2¬∞F
**–ò—Å—Ç–æ—á–Ω–∏–∫:** –†—É—á–Ω–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ –ø—Ä–æ—Ç–∏–≤ CozyTime –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä:**
```csv
CE CD 6C CE 00 9A 02 25 60 01 0C 08 0D 01,80,–ü–æ–¥ –ª–µ–∂–∞–Ω–∫–æ–π
CE CD 6C CE 00 99 01 42 57 01 0C 08 0D 3A,33.6,–£–ª–∏—Ü–∞
```

#### üìä history.csv
**–§–æ—Ä–º–∞—Ç:** `entity_id, state, last_changed`
**–°—Ç—Ä–æ–∫:** 1572 –∑–∞–ø–∏—Å–∏
**–ò—Å—Ç–æ—á–Ω–∏–∫:** –≠–∫—Å–ø–æ—Ä—Ç –∏–∑ Home Assistant
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ê–Ω–∞–ª–∏–∑ timestamp, –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—É–ª—ã

---

## üîÑ –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ (Next Steps)

### Phase 1: MQTT Migration
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Mosquitto broker
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `cozytime_bridge.yaml` (–∑–∞–º–µ–Ω–∞ API –Ω–∞ MQTT)
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MQTT Discovery

### Phase 2: Custom Component
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ `components/cozytime_mqtt/`
- [ ] –ü–µ—Ä–µ–Ω–æ—Å lambda –≤ `cozytime_mqtt.h`
- [ ] Python schema –¥–ª—è ESPHome
- [ ] –ß–∏—Å—Ç—ã–π YAML –∫–æ–Ω—Ñ–∏–≥ (10 —Å—Ç—Ä–æ–∫)

### Phase 3: Multiple Sensors
- [ ] –£–∑–Ω–∞—Ç—å MAC –∞–¥—Ä–µ—Å–∞ 3 –¥–∞—Ç—á–∏–∫–æ–≤
- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å 3 —Å–µ–Ω—Å–æ—Ä–∞–º–∏
- [ ] MQTT Discovery –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç—á–∏–∫–∞
- [ ] –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –∫–æ–º–Ω–∞—Ç–∞–º –≤ HA

---

## üìà –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

### v2.0 (—Ç–µ–∫—É—â–∞—è) - 8 –¥–µ–∫–∞–±—Ä—è 2025
- ‚úÖ –ü–æ–ª–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ BLE –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ (14 –±–∞–π—Ç)
- ‚úÖ Timestamp –≤ –ø–∞–∫–µ—Ç–µ (–±–∞–π—Ç—ã 9-13)
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ (18 —Ç–æ—á–µ–∫, RMS=0.064¬∞F)
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω –¥–∞—Ç—á–∏–∫: SHT40/SHT60
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: README + PROTOCOL_ANALYSIS
- ‚úÖ Datasheet SHT40

### v1.0 - 7 –¥–µ–∫–∞–±—Ä—è 2025
- ‚úÖ –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è CozyTime
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã, –≤–ª–∞–∂–Ω–æ—Å—Ç–∏, –±–∞—Ç–∞—Ä–µ–∏
- ‚úÖ Native API Home Assistant

---

## üéì –û–±—É—á–∞—é—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

### –î–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö:
1. –ß–∏—Ç–∞—Ç—å: `README.md`
2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞: —Å–µ–∫—Ü–∏—è "üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞"
3. –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º: —Å–µ–∫—Ü–∏—è "üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º"

**–í–∞–∂–Ω–æ:** –ù–∞–π–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π USB –ø–æ—Ä—Ç –¥–ª—è –≤–∞—à–µ–π –û–°:
- macOS: `/dev/cu.usbserial-*`, `/dev/cu.wchusbserial*`, `/dev/cu.SLAB_USBtoUART`
- Linux: `/dev/ttyUSB*`, `/dev/ttyACM*`
- Windows: `COM3`, `COM4`, etc.

### –î–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö:
1. –ß–∏—Ç–∞—Ç—å: `PROTOCOL_ANALYSIS.md`
2. –ò–∑—É—á–∏—Ç—å: `docs/SHT40 Datasheet.pdf`
3. –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å: —Å–∫—Ä–∏–ø—Ç—ã –≤ `helpers/`

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
1. –ü–æ–Ω—è—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª: `PROTOCOL_ANALYSIS.md`
2. –ò–∑—É—á–∏—Ç—å –∫–æ–¥: `cozytime_bridge.yaml` (lambda)
3. –í–∞–ª–∏–¥–∞—Ü–∏—è: `helpers/check_formula.py`
4. Custom component: (coming soon)

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**–ê–≤—Ç–æ—Ä:** @andreyorlov
**GitHub:** (–¥–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É)
**–õ–∏—Ü–µ–Ω–∑–∏—è:** MIT
**–í–µ—Ä—Å–∏—è:** 2.0
**–î–∞—Ç–∞:** 8 –¥–µ–∫–∞–±—Ä—è 2025

---

*–≠—Ç–æ—Ç —Ñ–∞–π–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–º*
